# V-Asset åç«¯PRDæ–‡æ¡£ç´¢å¼•

> **æ–‡æ¡£ç‰ˆæœ¬**: V1.1.0  
> **æœ€åæ›´æ–°**: 2025-12-03  
> **æŠ€æœ¯æ ˆ**: Go (Gin/gRPC), PostgreSQL, Redis, RabbitMQ

---

## ğŸ“‹ æ–‡æ¡£å¯¼èˆª

### æ€»ä½“æ¶æ„æ–‡æ¡£
- [**00_æ€»ä½“æ¶æ„PRD.md**](./00_æ€»ä½“æ¶æ„PRD.md) - ç³»ç»Ÿæ•´ä½“æ¶æ„ã€åŸºç¡€è®¾æ–½å’Œè·¨æœåŠ¡è®¾è®¡

### å¾®æœåŠ¡PRDæ–‡æ¡£

| åºå· | æœåŠ¡åç§° | æ–‡æ¡£ | æ ¸å¿ƒèŒè´£ |
|:---:|:---|:---|:---|
| 1 | API Gateway | [01_APIGatewayæœåŠ¡PRD.md](./01_APIGatewayæœåŠ¡PRD.md) | ç»Ÿä¸€æ¥å…¥å±‚ã€è·¯ç”±è½¬å‘ã€è®¤è¯é‰´æƒã€WebSocketç®¡ç† |
| 2 | Auth Service | [02_AuthæœåŠ¡PRD.md](./02_AuthæœåŠ¡PRD.md) | ç”¨æˆ·è®¤è¯ã€JWTç®¡ç†ã€æƒé™éªŒè¯ |
| 3 | Parser Service | [03_ParseræœåŠ¡PRD.md](./03_ParseræœåŠ¡PRD.md) | URLè§£æã€å…ƒæ•°æ®æå–ã€å¤šå¹³å°é€‚é… |
| 4 | Downloader Service | [04_DownloaderæœåŠ¡PRD.md](./04_DownloaderæœåŠ¡PRD.md) | è§†é¢‘ä¸‹è½½ã€ä»£ç†ç®¡ç†ã€æ–‡ä»¶å­˜å‚¨ã€ä»»åŠ¡è°ƒåº¦ â­æ ¸å¿ƒ |
| 5 | Asset Service | [05_AssetæœåŠ¡PRD.md](./05_AssetæœåŠ¡PRD.md) | ä¸‹è½½å†å²ã€ç”¨æˆ·é…é¢ã€æ•°æ®ç»Ÿè®¡ |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯å±‚"
        Web[Webå‰ç«¯]
    end
    
    subgraph "æ¥å…¥å±‚"
        Gateway[API Gateway<br/>ç«¯å£: 8080]
        WS[WebSocket Manager]
    end
    
    subgraph "ä¸šåŠ¡æœåŠ¡å±‚"
        Auth[Auth Service<br/>ç«¯å£: 9001<br/>è®¤è¯é‰´æƒ]
        Parser[Parser Service<br/>ç«¯å£: 9002<br/>å…ƒæ•°æ®è§£æ]
        Downloader[Downloader Service<br/>ç«¯å£: 9003<br/>ä¸‹è½½è°ƒåº¦]
        Asset[Asset Service<br/>ç«¯å£: 9004<br/>èµ„äº§ç®¡ç†]
    end
    
    subgraph "åŸºç¡€è®¾æ–½å±‚"
        PostgreSQL[(PostgreSQL<br/>ä¸»æ•°æ®åº“)]
        Redis[(Redis<br/>ç¼“å­˜/PubSub)]
        RabbitMQ[RabbitMQ<br/>æ¶ˆæ¯é˜Ÿåˆ—]
        LocalDisk[æœ¬åœ°ç£ç›˜<br/>æ–‡ä»¶å­˜å‚¨]
    end
    
    Web -->|HTTPS/WSS| Gateway
    Gateway -->|gRPC| Auth
    Gateway -->|gRPC| Parser
    Gateway -->|gRPC| Asset
    Gateway -->|MQ| Downloader
    
    Gateway -.->|Sub| Redis
    Downloader -->|Pub| Redis
    WS -.->|Sub| Redis
    
    Downloader -->|Consume| RabbitMQ
    Downloader -->|Write| LocalDisk
    Downloader -->|ç¬¬ä¸‰æ–¹API| ProxyAPI[ä»£ç†IPæœåŠ¡å•†]
    
    Auth --> PostgreSQL
    Asset --> PostgreSQL
    Downloader --> PostgreSQL
```

---

## ğŸ”§ æŠ€æœ¯æ ˆæ€»è§ˆ

### æ ¸å¿ƒæŠ€æœ¯
- **å¼€å‘è¯­è¨€**: Go 1.21+
- **Webæ¡†æ¶**: Gin (HTTP), gRPC (å¾®æœåŠ¡é€šä¿¡)
- **æ•°æ®åº“**: PostgreSQL 14+
- **ç¼“å­˜**: Redis 7+
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQ 3.12+
- **ä¸‹è½½å¼•æ“**: yt-dlp

### å¼€å‘å·¥å…·
- **ä¾èµ–ç®¡ç†**: Go Modules
- **æ•°æ®åº“è¿ç§»**: golang-migrate
- **APIæ–‡æ¡£**: Swagger/OpenAPI 3.0
- **æ—¥å¿—**: zap
- **é…ç½®ç®¡ç†**: viper

---

## ğŸ“Š æœåŠ¡é€šä¿¡åè®®

| é€šä¿¡åœºæ™¯ | åè®® | è¯´æ˜ |
|:---|:---|:---|
| å‰ç«¯ â†” Gateway | HTTP/HTTPS, WebSocket | RESTful API + å®æ—¶æ¨é€ |
| Gateway â†” ä¸šåŠ¡æœåŠ¡ | gRPC | é«˜æ€§èƒ½RPCè°ƒç”¨ |
| Gateway â†’ Downloader | RabbitMQ | å¼‚æ­¥ä»»åŠ¡åˆ†å‘ |
| Downloader â†’ å‰ç«¯ | Redis PubSub | ä¸‹è½½è¿›åº¦æ¨é€ |

---

## ğŸ“¦ æ•°æ®åº“è¡¨å½’å±

| è¡¨å | å½’å±æœåŠ¡ | ç”¨é€” |
|:---|:---|:---|
| `users` | Auth Service | ç”¨æˆ·è´¦å·ä¿¡æ¯ |
| `user_sessions` | Auth Service | ç”¨æˆ·ä¼šè¯ç®¡ç† |
| `download_history` | Asset + Downloader | ä¸‹è½½å†å²è®°å½•(å…±äº«) |
| `user_quotas` | Asset Service | ç”¨æˆ·é…é¢ç®¡ç† |

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### MVPé˜¶æ®µéƒ¨ç½²æ–¹æ¡ˆ
- **éƒ¨ç½²æ–¹å¼**: Docker Compose
- **æœåŠ¡å®ä¾‹**: æ¯ä¸ªæœåŠ¡å•å®ä¾‹
- **å­˜å‚¨**: æœ¬åœ°ç£ç›˜æŒ‚è½½ (`/data/vasset/`)
- **é«˜å¯ç”¨**: æš‚ä¸å®ç°,åç»­é€šè¿‡K8sæ‰©å±•

### ç”Ÿäº§ç¯å¢ƒè§„åˆ’
- **å®¹å™¨ç¼–æ’**: Kubernetes
- **æœåŠ¡ç½‘æ ¼**: Istio (å¯é€‰)
- **å¯¹è±¡å­˜å‚¨**: è¿ç§»è‡³S3å…¼å®¹å­˜å‚¨
- **è´Ÿè½½å‡è¡¡**: Nginx Ingress

---

## ğŸ“ éåŠŸèƒ½æ€§éœ€æ±‚æ¦‚è§ˆ

### æ€§èƒ½æŒ‡æ ‡
- **APIå“åº”æ—¶é—´**: P95 < 200ms
- **å¹¶å‘ä¸‹è½½æ•°**: æ”¯æŒ50ä¸ªå¹¶å‘ä¸‹è½½ä»»åŠ¡
- **æ–‡ä»¶ä¼ è¾“é€Ÿåº¦**: å—é™äºç½‘ç»œå¸¦å®½

### å®‰å…¨è¦æ±‚
- **è®¤è¯**: JWT Token,æœ‰æ•ˆæœŸ24å°æ—¶
- **ä¼ è¾“åŠ å¯†**: å…¨ç«™HTTPS
- **å¯†ç å­˜å‚¨**: bcryptåŠ å¯†
- **æ–‡ä»¶è®¿é—®æ§åˆ¶**: åŸºäºç”¨æˆ·æƒé™éªŒè¯

### å¯ç”¨æ€§
- **æœåŠ¡å¯ç”¨æ€§**: 99% (MVPé˜¶æ®µ)
- **æ•°æ®æŒä¹…åŒ–**: PostgreSQLä¸»ä»å¤‡ä»½
- **æ—¥å¿—ä¿ç•™**: 30å¤©

---

## ğŸ“– ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|:---|:---|:---|
| V1.1.0 | 2025-12-03 | æ‹†åˆ†å¾®æœåŠ¡PRDæ–‡æ¡£,å®Œå–„æ¶æ„è®¾è®¡ |
| V1.0.0 | 2025-12-02 | åˆå§‹ç‰ˆæœ¬,MVPæ¶æ„è®¾è®¡ |

---

## ğŸ‘¥ æ–‡æ¡£ç»´æŠ¤

å¦‚éœ€æ›´æ–°æ–‡æ¡£,è¯·éµå¾ªä»¥ä¸‹è§„åˆ™:
1. è·¨æœåŠ¡çš„æ¶æ„å˜æ›´éœ€åŒæ­¥æ›´æ–°æ€»ä½“æ¶æ„PRD
2. æ¥å£å˜æ›´éœ€åŒæ­¥æ›´æ–°è°ƒç”¨æ–¹å’Œæä¾›æ–¹çš„PRD
3. æ•°æ®åº“è¡¨ç»“æ„å˜æ›´éœ€åŒæ­¥æ›´æ–°ç›¸å…³æœåŠ¡PRD
4. é‡å¤§å˜æ›´éœ€æ›´æ–°ç‰ˆæœ¬å†å²

---

**ä¸‹ä¸€æ­¥**: è¯·æ ¹æ®æ‚¨çš„éœ€æ±‚é€‰æ‹©å¯¹åº”çš„æœåŠ¡PRDæ–‡æ¡£æŸ¥çœ‹è¯¦ç»†è®¾è®¡ã€‚
